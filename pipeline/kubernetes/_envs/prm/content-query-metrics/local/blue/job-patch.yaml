apiVersion: flink.apache.org/v1beta1
kind: FlinkDeployment
metadata:
  name: flink-job
spec:
  job:
    args: [
      "--s3Bucket=promoted-event-logs",
      "--jobLabel=blue",
      "--sideOutputDebugLogging",
      "--startFromEarliest",

      # Since we use Flink SQL, we need to auto-generate UIDs.
      "--no-disableAutoGeneratedUIDs",

      "--parallelism=1",
      "--maxParallelism=1",

      "--daily",
      "--weekly",
      "--outputParquet",

      # Periodically update the watermark locally.
      # Needs a longer delay for slow job startup.
      "--watermarkIdleness=PT5M",
      "--checkpointInterval=PT1M",
    ]
  flinkConfiguration:
    state.savepoints.dir: s3a://promoted-event-logs/content-query-metrics-flink-job-blue/savepoints
    state.checkpoints.dir: s3a://promoted-event-logs/content-query-metrics-flink-job-blue/checkpoints
    high-availability.storageDir: s3a://promoted-event-logs/content-query-metrics-flink-job-blue/ha

